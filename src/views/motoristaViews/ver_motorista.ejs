<!DOCTYPE html>
<h2>Lista de Motoristas Cadastrados</h2>
<div id="message" class="alert" style="display:none;"></div>
<p style="margin: 12px 0px 6px 0px;"><a href="#" onclick="carregarMotoristas()">Atualizar Lista</a></p>
<table class="table">
	<thead>
		<th>ID</th>
		<th>Nome do Motorista</th>
		<th>Endereço do Motorista</th>
		<th>Contacto Principal</th>
		<th>Contacto de Emergência</th>
	</thead>
	<tbody id="tableBody"></tbody>
</table>

<script>
	// Carrega a lista de motoristas
	async function carregarMotoristas() {
		const token = localStorage.getItem('token');
        verificarToken(token);
		try {
			const response = await fetch('/api/motoristas/list', {
				method: 'POST',
				headers: {
					'Authorization': `Bearer ${token}`
				}
			});
			const result = await response.json();
			const messageDiv = document.getElementById('message');

			if (result.error) {
				emitirMensagem(messageDiv, 'danger', result.error || 'Erro ao listar motoristas.');
			} else {
				const tableBody = document.getElementById('tableBody');
				tableBody.innerHTML = '';
				if (result.length <= 0) {
					emitirMensagem(messageDiv, 'warning', 'Não existe motoristas cadastrados.');
				} else {
					for (let i = 0; i < result.length; i++) {
						const element = result[i];
						tableBody.innerHTML += `<tr id="colum${i}"></tr>`;
						const atualColm = document.getElementById(`colum${i}`);
						
						atualColm.innerHTML += `<td>${element.id}</td>`;
						atualColm.innerHTML += `<td>${element.nome}</td>`;
						atualColm.innerHTML += `<td>${element.endereco}</td>`;
						atualColm.innerHTML += `<td>${element.telefone}</td>`;
						atualColm.innerHTML += `<td>${element.telefone_emergencia}</td>`;
					}
				}
			}
		} catch (err) {
			console.error('Erro:', err);
			const messageDiv = document.getElementById('message');
			emitirMensagem(messageDiv, 'danger', 'Erro na conexão.');
		}
	}

	// Executa ao carregar
	document.addEventListener('DOMContentLoaded', carregarMotoristas());
</script>
